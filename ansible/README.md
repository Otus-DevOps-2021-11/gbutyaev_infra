# gbutyaev_infra


## ДЗ Знакомство с облачной инфраструктурой и облачными сервисами


gbutyaev Infra repository

bastion_IP = 51.250.23.61
someinternalhost_IP = 10.129.0.32


Подлючиться в одну команду к удаленному внунтреннему серверу можно с помощью параметра `-J: ssh -i ~/.ssh/appuser -A -J appuser@51.250.23.61 appuser@10.129.0.32`


## ДЗ Основные сервисы Yandex Cloud


testapp_IP = 84.201.128.214
testapp_port = 9292

## ДЗ Модели управления инфраструктурой. Подготовка образов с помощью Packer

- Установил на локальный хост Packer и сделал для него сервисный аккаунт на YC
- Создал директорию `packer`, внутри которой сделал тимплейт для разворачивания образа ВМ на YC
- Параметризировал тимплейт, создава `variables.json`. Сам файл с переменными добавил в `.gitignore`

## ДЗ Знакомство с Terraform

- Установил на локальный хост terraform и создал директорию `terraform` в своей инфре
- В директории terraform создал `main.tf`, в котором описал конфигурацию создания ВМ на основе образа packer из  предыдущего ДЗ
- Создал файл `outputs.tf`. Теперь можно смотреть значения различных параметров через команду terraform output
- В `main.tf` добавил провиженеры для добавления файлов с локального хоста на удаленную ВМ
- Параметризировал `main.tf`, создав `variables.tf` и `terraform.tfvars`

## Принципы организации инфраструктурного кода и работа над инфраструктурой в команде на примере Terraform

- Задал ip для инстанса с приложением в виде внешнего ресурса. Для этого определил ресурсы в `main.tf`
- В конфигурации ВМ определил ip для создаваемого инстанса
- Выношу БД в отдельный инстанс. Создаю в директории `packer` отдельный тимплейт для разворачивания образа БД. По аналогии создаю образ для Ruby
- В директории `terraform` создаю два тимплейта для разворачивания ВМ на основе созданных образов
- Конфигурацию сети и подсести вынес в отдельный тимплейт `vpc.tf`
- Добавил nat адреса в output переменные
- Разбиваю конфигурацию по модулям `db` и `app`
- Создал две директории `stage` и `prod`, тимплейты в которых ссылаются на модули

## Управление конфигурацией. Знакомство с Ansible

- На своем локальном хосте установил ansible и python3
- Создал файл inventory, в котором прописал адреса инстансов, с которыми буду работать
- Вынес всю конфигурации в ansible.cfg
- Создал группы хостов в  файле inventory
- Используя модуль гит склонировал репозиторий на удаленном инстансе
- Создал плейбук, который выполняет аналогичное действие по клонированию репозитория на удаленный инстанс
- При выполнении плейбука никаких изменений не произлошло на удаленном сервере, т.к. такой репозиторий уже существует. Если удалить репозиторий, то при выполнении плейбука произдойдут изменения и устаноивится репозиторий


Домашнее задание разработано для курса [DevOps практики и инструменты](https://otus.ru/lessons/devops-praktiki-i-instrumenty/)
